<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>tengyuanjack&#39;s blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2020-03-25T05:27:01.456Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Geortan</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>中介者模式</title>
    <link href="http://yoursite.com/2020/03/25/design_pattern/%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
    <id>http://yoursite.com/2020/03/25/design_pattern/中介者模式/</id>
    <published>2020-03-25T05:17:39.000Z</published>
    <updated>2020-03-25T05:27:01.456Z</updated>
    
    <content type="html"><![CDATA[<p>行为型设计模式的一种，用于减少各个结构的直接交互，将交互逻辑放在中介者身上。</p><a id="more"></a><h3 id="【DP】定义"><a href="#【DP】定义" class="headerlink" title="【DP】定义"></a>【DP】定义</h3><p>用一个中介对象来封装一系列的对象交互。中介者使各对象不需要显式地相互引用，从而使其耦合松散，而且可以独立地改变它们之间的交互。</p><h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><ol><li><h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src alt="中介者模式"></p></li></ol><h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;行为型设计模式的一种，用于减少各个结构的直接交互，将交互逻辑放在中介者身上。&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>备忘录模式</title>
    <link href="http://yoursite.com/2020/03/24/design_pattern/%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F/"/>
    <id>http://yoursite.com/2020/03/24/design_pattern/备忘录模式/</id>
    <published>2020-03-24T12:34:51.000Z</published>
    <updated>2020-03-24T12:56:16.448Z</updated>
    
    <content type="html"><![CDATA[<p>行为型模式的一种，用于备份状态、屏蔽大对象中的属性等场景。</p><a id="more"></a><h3 id="【DP】定义"><a href="#【DP】定义" class="headerlink" title="【DP】定义"></a>【DP】定义</h3><p>在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态。这样以后就可将该对象恢复到原先保存的状态。</p><h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><ol><li>备份状态：当有状态转换时，出现状态转换失败时需要将状态回退回之前的状态，需要备份；</li><li>需要保存大对象中的一些个别属性，可以类似备忘录模式创建一个“小对象”来存储；</li><li>对外屏蔽大对象中的一些属性（只展示个别属性），可以类似备忘录模式创建一个“小对象”来展示。</li></ol><h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src="https://s2.ax1x.com/2020/02/07/1gnJMQ.png" alt="备忘录模式"></p><p>类图核心是备忘录类，以及外部保存类和备忘录类的聚合关系，即外部保存类对象可以保存多个备忘录对象。</p><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>多模式共同完成一件事：当执行撤销操作时，可以和命令模式一起使用。使用备忘录保存状态，命令模式中的行为请求者执行撤销命令。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;行为型模式的一种，用于备份状态、屏蔽大对象中的属性等场景。&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>命令模式</title>
    <link href="http://yoursite.com/2020/03/24/design_pattern/%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F/"/>
    <id>http://yoursite.com/2020/03/24/design_pattern/命令模式/</id>
    <published>2020-03-24T11:10:57.000Z</published>
    <updated>2020-03-24T12:17:49.685Z</updated>
    
    <content type="html"><![CDATA[<p>行为型设计模式的一种，将行为的请求者和行为的处理者分开。</p><a id="more"></a><h3 id="【DP】定义"><a href="#【DP】定义" class="headerlink" title="【DP】定义"></a>【DP】定义</h3><p>将一个请求封装为一个对象，从而使你可用不同的请求对客户进行参数化；对请求排队或记录请求日志，以及支持可撤销的操作。</p><h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><p>当行为的请求者和行为的处理者耦合度太高的时候，需要考虑使用命令模式，将行为以命令类的形式抽离出来，从而将请求者和处理者解耦。</p><h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src="https://s2.ax1x.com/2020/02/07/1gnBGT.png" alt="命令模式"></p><p>类图核心： 1. “命令”依赖“行为处理者”， 即命令的定义不依赖具体处理命令的人，同一个命令可以由不同处理命令的人处理，将命令和执行人抽象分开；</p><ol start="2"><li>通过命令接口将行为请求者和行为处理者分开，让请求者只做记录有哪些命令执行的事儿，让处理者只包含处理具体命令的代码，做到二者职责分离并保证职责单一。</li></ol><p>抽离出来的命令类并不真正的执行命令，抽离出来是为了让请求者更好的记录，保证多个命令能够排队、记录或撤销。</p><h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><p>当在客户端设计一张报表时，会有很多命令，如设置显示区域、设置排序字段、设置字体等，同时还有一种非功能性功能：撤销与恢复。</p><p>在操作报表时的各种命令可以放在一个列表中，当撤销时从列表中移除组后一个元素即可。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 行为处理者</span><br><span class="line"> */</span><br><span class="line">public class Executor &#123;</span><br><span class="line">    public void setFontSize() &#123;</span><br><span class="line">        // do something</span><br><span class="line">    &#125;</span><br><span class="line">    public void undoSetFontSize() &#123;</span><br><span class="line">        // do something </span><br><span class="line">    &#125;</span><br><span class="line">    public void setOrder() &#123;</span><br><span class="line">        // do something</span><br><span class="line">    &#125;</span><br><span class="line">    public void undoSetOrder() &#123;</span><br><span class="line">        // do something</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 命令抽象类</span><br><span class="line"> */</span><br><span class="line">public abstract class Command &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 执行人</span><br><span class="line">     */</span><br><span class="line">    Executor executor;</span><br><span class="line"></span><br><span class="line">    public Command(Executor executor) &#123;</span><br><span class="line">        this.executor = executor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 执行该命令</span><br><span class="line">     */</span><br><span class="line">    void execute();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 撤销时应该做的事</span><br><span class="line">     */</span><br><span class="line">    void fireUndo();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 设置字体大小命令</span><br><span class="line"> */</span><br><span class="line">public class SetFontSizeCommand extends Command &#123;</span><br><span class="line">    public SetFontSizeCommand(Executor executor) &#123;</span><br><span class="line">        super(executor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void execute() &#123;</span><br><span class="line">        this.executor.setFontSize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void fireUndo() &#123;</span><br><span class="line">        this.executor.undoSetFontSize();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 设置排序命令</span><br><span class="line"> */</span><br><span class="line">public class SetOrderCommand extends Command &#123;</span><br><span class="line">    public SetOrderCommand(Executor executor) &#123;</span><br><span class="line">        super(executor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void execute() &#123;</span><br><span class="line">        this.executor.setOrder();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void fireUndo() &#123;</span><br><span class="line">        this.executor.undoSetOrder();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 操作记录</span><br><span class="line"> */</span><br><span class="line">public class OperateRecord &#123;</span><br><span class="line">    // 命令列表</span><br><span class="line">    List&lt;Command&gt; commands = new LinkedList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 增加命令</span><br><span class="line">     */</span><br><span class="line">    public void addCommand(Command command) &#123;</span><br><span class="line">        commands.add(command);</span><br><span class="line">        // 最多撤销20步，超过则去掉最先加入列表的命令</span><br><span class="line">        if (commands.size() &gt; 20) &#123;</span><br><span class="line">            commands.remove(0);</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     /**</span><br><span class="line">      * 执行命令</span><br><span class="line">      */</span><br><span class="line">     public void execute() &#123;</span><br><span class="line">        for (Command com : commands) &#123;</span><br><span class="line">            com.execute();</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">    // 撤销</span><br><span class="line">    public void undo() &#123;</span><br><span class="line">        if (commands.size() == 0) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        ICommand command = commands.get(commands.size() - 1);</span><br><span class="line">        // 移除最后一个命令</span><br><span class="line">        commands.remove(command);</span><br><span class="line">        // 触发移除命令的效果</span><br><span class="line">        command.fireUndo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>再次重申该模式的两个重点：</p><ol><li>行为请求者只记录命令，并不执行；</li><li>将命令与行为处理者分开，命令中指定行为处理者是谁，行为请求者只记录命令，而不记录具体处理者。</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;行为型设计模式的一种，将行为的请求者和行为的处理者分开。&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>迭代器模式</title>
    <link href="http://yoursite.com/2020/03/19/design_pattern/%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
    <id>http://yoursite.com/2020/03/19/design_pattern/迭代器模式/</id>
    <published>2020-03-19T01:08:01.000Z</published>
    <updated>2020-03-19T11:50:46.777Z</updated>
    
    <content type="html"><![CDATA[<p>行为型模式，已被集成在使用的各种编程语言中，java的forEach语句就使用了迭代器模式，Iterable<t>和Iterator为迭代器模式的实现。</t></p><a id="more"></a><h3 id="【DP】定义"><a href="#【DP】定义" class="headerlink" title="【DP】定义"></a>【DP】定义</h3><p>提供一种方法顺序访问一个聚合对象中的各个元素，而又不是暴露该对象的内部表示。</p><h3 id="Java使用场景"><a href="#Java使用场景" class="headerlink" title="Java使用场景"></a>Java使用场景</h3><p>Collection<e>接口继承Iterable<e>, Collection<e>的子类都分别实现自己的Iterator<e>。</e></e></e></e></p><p>Iterator<e>中主要的两个方法：</e></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public interface Iterator&lt;E&gt; &#123;</span><br><span class="line">    boolean hasNext();</span><br><span class="line">    E next();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>举例： ArrayList<e>中的Itr：</e></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">private class Itr implements Iterator&lt;E&gt; &#123;</span><br><span class="line">        int cursor;       // index of next element to return 当前位置</span><br><span class="line">        int lastRet = -1; // index of last element returned; -1 if no such 上一个位置 </span><br><span class="line">        int expectedModCount = modCount;  // 期待的ModeCount，控制并发修改</span><br><span class="line"></span><br><span class="line">        public boolean hasNext() &#123;</span><br><span class="line">            // 当前位置不等于list大小，则还有下一个元素可以使用</span><br><span class="line">            return cursor != size;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">        public E next() &#123;</span><br><span class="line">            checkForComodification();</span><br><span class="line">            int i = cursor;</span><br><span class="line">            if (i &gt;= size)</span><br><span class="line">                throw new NoSuchElementException();</span><br><span class="line">            Object[] elementData = ArrayList.this.elementData;</span><br><span class="line">            if (i &gt;= elementData.length)</span><br><span class="line">                throw new ConcurrentModificationException();</span><br><span class="line">            cursor = i + 1;</span><br><span class="line">            return (E) elementData[lastRet = i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void remove() &#123;</span><br><span class="line">            if (lastRet &lt; 0)</span><br><span class="line">                throw new IllegalStateException();</span><br><span class="line">            checkForComodification();</span><br><span class="line"></span><br><span class="line">            try &#123;</span><br><span class="line">                // 移除元素做法是： 将lastRet后的元素拷贝到lastRet位置，然后将最后一个置null，让gc回收</span><br><span class="line">                ArrayList.this.remove(lastRet);</span><br><span class="line">                cursor = lastRet;</span><br><span class="line">                lastRet = -1;</span><br><span class="line">                expectedModCount = modCount;</span><br><span class="line">            &#125; catch (IndexOutOfBoundsException ex) &#123;</span><br><span class="line">                throw new ConcurrentModificationException();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        final void checkForComodification() &#123;</span><br><span class="line">            // modCont全局维护，如果不等于expectedModCount，说明有人改过了</span><br><span class="line">            if (modCount != expectedModCount)</span><br><span class="line">                throw new ConcurrentModificationException();</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>Iterator<e>提供了一种遍历元素的接口，ArrayList<e>是按照顺序去取的，这也给我们提供了一种思路，当有复杂遍历顺序时（比如数据有层次关系时，需要按照深度优先遍历），可以自定义迭代器实现。</e></e></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;行为型模式，已被集成在使用的各种编程语言中，java的forEach语句就使用了迭代器模式，Iterable&lt;t&gt;和Iterator为迭代器模式的实现。&lt;/t&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="设计模式" scheme="http://yoursite.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>数据库临时表</title>
    <link href="http://yoursite.com/2020/03/03/database/%E4%B8%B4%E6%97%B6%E8%A1%A8/"/>
    <id>http://yoursite.com/2020/03/03/database/临时表/</id>
    <published>2020-03-03T01:52:00.000Z</published>
    <updated>2020-03-03T06:34:48.645Z</updated>
    
    <content type="html"><![CDATA[<p>oracle和mysql的临时表使用</p><a id="more"></a><h3 id="临时表"><a href="#临时表" class="headerlink" title="临时表"></a>临时表</h3><p>临时表类似中间表，在各种类型数据库中都有，主要用在：</p><ol><li>数据预处理；</li><li>频繁聚合数据场景；</li><li>已有表的索引不符合性能要求时，可以新建临时表在临时表中搜索；</li><li>在项目中使用oracle11g还遇到一个问题，in后的内容不能超过1000个，故需要使用临时表将in中的内容放到临时表中；</li><li>程序执行过程中可能需要存放一些临时的数据，这些数据在整个程序的会话过程中都需要用到。</li></ol><h3 id="oracle临时表"><a href="#oracle临时表" class="headerlink" title="oracle临时表"></a>oracle临时表</h3><h4 id="创建语句"><a href="#创建语句" class="headerlink" title="创建语句"></a>创建语句</h4><p><img src="https://s2.ax1x.com/2020/03/03/3hYwoF.png" alt="3hYwoF.png"></p><p>图中矩形框中的关键字是创建临时表的必要字段，椭圆框威非必要字段。</p><h4 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h4><ul><li><strong>会话级临时表</strong> </li><li><strong>事务级临时表</strong><br>会话级临时表采用<strong>on commit preserve rows</strong>；而事务级则采用<strong>on commit delete rows</strong>；用法上，会话级别只有当会话结束临时表中的数据才会被清空（truncate），而且事务级临时表则不管是commit、rollback或者是会话结束，临时表中的数据都将被清空（truncate）。</li></ul><h4 id="临时表的不足"><a href="#临时表的不足" class="headerlink" title="临时表的不足"></a>临时表的不足</h4><ul><li>不支持lob对象（大对象）</li><li>不支持主外键关联</li></ul><h3 id="mysql临时表"><a href="#mysql临时表" class="headerlink" title="mysql临时表"></a>mysql临时表</h3><p>mysql临时表在当前连接可见（会话级别），在当前代码连接或者客户端连接过程中存在。</p><h4 id="创建语句-1"><a href="#创建语句-1" class="headerlink" title="创建语句"></a>创建语句</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE TEMPORARY TABLE table_name (</span><br><span class="line">    字段信息</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>注： 使用<code>show tables</code>看不到临时表</p><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol><li>在实际使用过程中，如果使用系统临时表不能满足要求（如想保留表结构），可以自己建表当临时表;</li><li>mysql的in字句中不限制数量，但是mysql的sql语句长度有限制（4MB）。</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;oracle和mysql的临时表使用&lt;/p&gt;
    
    </summary>
    
    
      <category term="database" scheme="http://yoursite.com/tags/database/"/>
    
  </entry>
  
  <entry>
    <title>Tomcat的ClassLoader</title>
    <link href="http://yoursite.com/2020/01/02/java/Tomcat%E7%9A%84ClassLoader/"/>
    <id>http://yoursite.com/2020/01/02/java/Tomcat的ClassLoader/</id>
    <published>2020-01-02T11:42:51.000Z</published>
    <updated>2020-01-12T02:58:54.631Z</updated>
    
    <content type="html"><![CDATA[<p>本文讲解Tomcat的类加载器机制和遇到的一个项目问题及排查过程。</p><a id="more"></a><h2 id="Tomcat的classloader"><a href="#Tomcat的classloader" class="headerlink" title="Tomcat的classloader"></a>Tomcat的classloader</h2><h2 id="遇到的项目问题及排查过程"><a href="#遇到的项目问题及排查过程" class="headerlink" title="遇到的项目问题及排查过程"></a>遇到的项目问题及排查过程</h2><p>项目中需要动态编译类，所以用到了jdk中的tools.jar（见<a href>如何在代码中编译java类</a>)，此前项目一直用中间件服务的形式启动，启动脚本中指定了jdk，没有任何问题。后来将项目打成了war包放在原生tomcat中执行，出现了找不到tools.jar中类的错误。</p><p>排查过程如下：</p><ol><li>查看启动日志，发现如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">信息 [main] org.apache.catalina.startup.VersionLoggerListener.log Java Home:             /usr/local/java/jre</span><br></pre></td></tr></table></figure></li></ol><p>用的是JRE_HOME，只有运行时环境，当然就没有工具类了；</p><ol start="2"><li>需要重新指定java home，于是依次查看 <code>startup.sh</code>-&gt;<code>catalina.sh</code>-&gt;<code>setclasspath.sh</code>，看到了如下解释：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#   JAVA_HOME       Must point at your Java Development Kit installation.</span><br><span class="line">#                   Required to run the with the &quot;debug&quot; argument.</span><br><span class="line">#</span><br><span class="line">#   JRE_HOME        Must point at your Java Runtime installation.</span><br><span class="line">#                   Defaults to JAVA_HOME if empty. If JRE_HOME and JAVA_HOME</span><br><span class="line">#                   are both set, JRE_HOME is used.</span><br></pre></td></tr></table></figure></li></ol><p>当环境变量中JRE_HOME和JAVA_HOME都设置，且不是debug模式时，使用JRE_HOME。</p><p>从而发现问题所在。</p><ol start="3"><li>在setclasspath.sh中将JRE_HOME显式指定为JAVA_HOME，<code>JRE_HOME=&quot;$JAVA_HOME&quot;</code>，天真的以为这样就可以，但是看启动日志，发现仍然使用的JAVA_HOME/jre，所以没有更好的方法了，只能将tools.jar放到工程中了。</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文讲解Tomcat的类加载器机制和遇到的一个项目问题及排查过程。&lt;/p&gt;
    
    </summary>
    
    
      <category term="java" scheme="http://yoursite.com/tags/java/"/>
    
      <category term="tomcat" scheme="http://yoursite.com/tags/tomcat/"/>
    
  </entry>
  
  <entry>
    <title>自定义ClassLoader的编写和使用</title>
    <link href="http://yoursite.com/2020/01/02/java/%E8%87%AA%E5%AE%9A%E4%B9%89ClassLoader%E7%9A%84%E7%BC%96%E5%86%99%E5%92%8C%E4%BD%BF%E7%94%A8/"/>
    <id>http://yoursite.com/2020/01/02/java/自定义ClassLoader的编写和使用/</id>
    <published>2020-01-02T11:37:47.000Z</published>
    <updated>2020-01-04T08:44:51.521Z</updated>
    
    <content type="html"><![CDATA[<p>本文主要讲解ClassLoader的含义、jvm类加载机制、ClassLoader类解读和实例。</p><a id="more"></a><h2 id="一、ClassLoader含义"><a href="#一、ClassLoader含义" class="headerlink" title="一、ClassLoader含义"></a>一、ClassLoader含义</h2><p>在《深入理解JAVA虚拟机中》这么解释：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在类加载阶段，通过类的全限定名来获取描述此类的二进制字节流，让应用程序决定如何获取所需要的类。</span><br></pre></td></tr></table></figure></p><h2 id="二、java虚拟机类加载机制"><a href="#二、java虚拟机类加载机制" class="headerlink" title="二、java虚拟机类加载机制"></a>二、java虚拟机类加载机制</h2><h3 id="类加载阶段"><a href="#类加载阶段" class="headerlink" title="类加载阶段"></a>类加载阶段</h3><p>jvm类加载包括五个子阶段： 加载-&gt;准备-&gt;验证-&gt;解析-&gt;初始化， 其中使用Classloader去加载类的地方就在“加载”阶段。</p><h3 id="类加载器和双亲委派模型"><a href="#类加载器和双亲委派模型" class="headerlink" title="类加载器和双亲委派模型"></a>类加载器和双亲委派模型</h3><p><strong>JVM类加载器分为：</strong></p><p>(1) Bootstrap ClassLoader(启动类加载器)</p><p>负责加载JAVA_HOME/lib中的类和-Xbootclasspath指定的类</p><p>(2) Extension ClassLoader(扩展类加载器)</p><p>负责加载JAVA_HOME/lib/ext中的类</p><p>(3) Application ClassLoader(应用程序类加载器/系统类加载器)，还可定义自定义类加载器。</p><p>负责加载用户类路径上的类，如果用户没有自定义类加载器，则AppClassLoader为默认类加载器。 同时，ClassLoader.getSystemClassLoader()返回的是该类。</p><p><strong>使用<code>ClassLoader.getParent()</code>查看父加载器, 可以看到：</strong></p><ol><li>自定义类加载器(不主动设置parent)的parent是AppClassLoader;</li><li>AppClassLoader的parent是ExtClassLoader；</li><li>ExtClassLoader的parent是null;</li><li>同时，需要注意上述类加载器不是类继承关系。</li></ol><p><strong>双亲委派模型的含义是： </strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如果一个类加载器收到了类加载的请求，它首先不会自己去尝试加载，而是将请求委派给父加载器</span><br><span class="line">，只有当父加载器加载不到时，才会让子加载器加载。</span><br></pre></td></tr></table></figure></p><p>这样就保证了在同一个JVM中基础类都只有一份，且每个类都和类加载器一起构成了一个层级关系。</p><p>然而，“规则是用来打破的”，有很多情况会破坏双亲委派模型，如： 涉及SPI（Service Provider Interface）的加载动作（JNDI、JDBC等）、热部署和热加载等操作。</p><h3 id="ClassLoader加载类"><a href="#ClassLoader加载类" class="headerlink" title="ClassLoader加载类"></a>ClassLoader加载类</h3><p>很好的说明了双亲委派模型的动作</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">protected Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException</span><br><span class="line">    &#123;</span><br><span class="line">        // 同一个类不应该同时被多线程加载，故加锁</span><br><span class="line">        synchronized (getClassLoadingLock(name)) &#123;</span><br><span class="line">            // First, check if the class has already been loaded</span><br><span class="line">            Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line">            if (c == null) &#123;</span><br><span class="line">                long t0 = System.nanoTime();</span><br><span class="line">                try &#123;</span><br><span class="line">                    if (parent != null) &#123;</span><br><span class="line">                        c = parent.loadClass(name, false);</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        c = findBootstrapClassOrNull(name);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">                    // ClassNotFoundException thrown if class not found</span><br><span class="line">                    // from the non-null parent class loader</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                if (c == null) &#123;</span><br><span class="line">                    // If still not found, then invoke findClass in order</span><br><span class="line">                    // to find the class.</span><br><span class="line">                    long t1 = System.nanoTime();</span><br><span class="line">                    c = findClass(name);  // 若自定义类加载器，需要重写的方法</span><br><span class="line"></span><br><span class="line">                    // this is the defining class loader; record the stats</span><br><span class="line">                    sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);</span><br><span class="line">                    sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</span><br><span class="line">                    sun.misc.PerfCounter.getFindClasses().increment();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            if (resolve) &#123;</span><br><span class="line">                resolveClass(c);</span><br><span class="line">            &#125;</span><br><span class="line">            return c;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="三、-实例"><a href="#三、-实例" class="headerlink" title="三、 实例"></a>三、 实例</h2><p>自定义ClassLoader，需要继承ClassLoader，至少重写findClass(String)方法。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 自定义类加载器，只支持class文件</span><br><span class="line"> */</span><br><span class="line">public class MyClassLoader extends ClassLoader &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 类路径</span><br><span class="line">     */</span><br><span class="line">    private String classPath;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 资源路径</span><br><span class="line">     */</span><br><span class="line">    private String resourcePath;</span><br><span class="line"></span><br><span class="line">    private static MyClassLoader instance = null;</span><br><span class="line"></span><br><span class="line">    public MyClassLoader(String classPath, String resourcePath) &#123;</span><br><span class="line">        this.classPath = classPath;</span><br><span class="line">        this.resourcePath = resourcePath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 同步</span><br><span class="line">     */</span><br><span class="line">    public static synchronized MyClassLoader getMyClassLoader(String classPath, String resourcePath) &#123;</span><br><span class="line">        if (instance == null) &#123;</span><br><span class="line">            instance = new MyClassLoader(classPath, resourcePath);</span><br><span class="line">        &#125;</span><br><span class="line">        return instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 重写该方法，该方法在父类ClassLoader.loadClass(String)中调用</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123;</span><br><span class="line">        // 已加载，直接使用</span><br><span class="line">        Class&lt;?&gt; clz = super.findLoadedClass(name);</span><br><span class="line">        if (clz != null) &#123;</span><br><span class="line">            return clz;</span><br><span class="line">        &#125;</span><br><span class="line">        // 手动加载classPath中的类</span><br><span class="line">        return loadMyClass(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private Class&lt;?&gt; loadMyClass(String name) &#123;</span><br><span class="line">        // 将类名中的点改为文件分隔符，并添加.class后缀</span><br><span class="line">        String clzName = name.replace(&quot;.&quot;, File.separator);</span><br><span class="line">        clzName += &quot;.class&quot;;</span><br><span class="line">        // 从文件中读</span><br><span class="line">        String filePath = classPath + File.separator + clzName;</span><br><span class="line">        File file = new File(filePath);</span><br><span class="line">        if (!file.exists()) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        FileInputStream in = null;</span><br><span class="line">        ByteArrayOutputStream out = null;</span><br><span class="line">        byte[] classBytes = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            in = new FileInputStream(file);</span><br><span class="line">            out = new ByteArrayOutputStream();</span><br><span class="line">            byte[] buffer = new byte[1024];</span><br><span class="line">            int size = 0;</span><br><span class="line">            while ((size = in.read(buffer)) != -1) &#123;</span><br><span class="line">                out.write(buffer, 0, size);</span><br><span class="line">            &#125;</span><br><span class="line">            classBytes = out.toByteArray();</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            closeQuietly(in);</span><br><span class="line">            closeQuietly(out);</span><br><span class="line">        &#125;</span><br><span class="line">        if (classBytes == null) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return super.defineClass(name, classBytes, 0, classBytes.length);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 静默关闭</span><br><span class="line">     * @param obj</span><br><span class="line">     */</span><br><span class="line">    private void closeQuietly(Closeable obj) &#123;</span><br><span class="line">        if (obj != null) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                obj.close();</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 重写该方法，用于获取资源</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public URL findResource(String name) &#123;</span><br><span class="line">        String path = resourcePath + File.separator + name;</span><br><span class="line">        File file = new File(path);</span><br><span class="line">        if (!file.exists()) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        try &#123;</span><br><span class="line">            return file.toURI().toURL();</span><br><span class="line">        &#125; catch (MalformedURLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">public class Test &#123;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 根目录</span><br><span class="line">     */</span><br><span class="line">    private static final String CLASSLOAD_PATH_DIR = &quot;C:\\Users\\Administrator\\Desktop\\testclassload&quot;;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 类路径</span><br><span class="line">     */</span><br><span class="line">    private static final String CLASSLOAD_PATH_CLASS = &quot;classes&quot;;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 资源路径</span><br><span class="line">     */</span><br><span class="line">    private static final String CLASSLOAD_PATH_RESOURCES = &quot;\\resources&quot;;</span><br><span class="line">    </span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        String classPath = CLASSLOAD_PATH_DIR + File.separator + CLASSLOAD_PATH_CLASS;</span><br><span class="line">        String resourcePath = CLASSLOAD_PATH_DIR + File.separator + CLASSLOAD_PATH_RESOURCES;</span><br><span class="line">        MyClassLoader myClassLoader = MyClassLoader.getMyClassLoader(classPath, resourcePath);</span><br><span class="line">        </span><br><span class="line">        // 待加载类，不在当前工程中</span><br><span class="line">        String bookClzName = &quot;com.test.Book&quot;;</span><br><span class="line">        Class&lt;?&gt; bookClz = myClassLoader.loadClass(bookClzName);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        System.out.println(&quot;bookClz&apos;s classLoader is : &quot; + bookClz.getClassLoader().getClass().getName());</span><br><span class="line">        </span><br><span class="line">        // 加载后new出实例</span><br><span class="line">        Constructor constructor = bookClz.getConstructor(new Class[] &#123;String.class, double.class&#125;);     </span><br><span class="line">        Method method = bookClz.getMethod(&quot;puzzleTime&quot;);</span><br><span class="line">        if (!method.isAccessible()) &#123;</span><br><span class="line">            method.setAccessible(true);</span><br><span class="line">        &#125;</span><br><span class="line">        method.invoke(constructor.newInstance(new Object[] &#123;&quot;Book0&quot;, 20&#125;));</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">运行结果： </span><br><span class="line">bookClz&apos;s classLoader is : com.test.MyClassLoader</span><br><span class="line">OK, you found me!</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 待加载类</span><br><span class="line"> */</span><br><span class="line">public class Book &#123;</span><br><span class="line"></span><br><span class="line">    private String bookName;</span><br><span class="line">    </span><br><span class="line">    private double price;</span><br><span class="line">    </span><br><span class="line">    public Book(String bookName, double price) &#123;</span><br><span class="line">        this.bookName = bookName;</span><br><span class="line">        this.price = price;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public void puzzleTime() &#123;</span><br><span class="line">        System.out.println(&quot;OK, you found me!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文主要讲解ClassLoader的含义、jvm类加载机制、ClassLoader类解读和实例。&lt;/p&gt;
    
    </summary>
    
    
      <category term="java" scheme="http://yoursite.com/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>mysql触发器</title>
    <link href="http://yoursite.com/2019/12/31/database/mysql%E8%A7%A6%E5%8F%91%E5%99%A8/"/>
    <id>http://yoursite.com/2019/12/31/database/mysql触发器/</id>
    <published>2019-12-31T02:06:39.000Z</published>
    <updated>2020-01-12T04:09:29.145Z</updated>
    
    <content type="html"><![CDATA[<p>mysql触发器创建和使用</p><a id="more"></a><h3 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h3><p>触发器是一种特殊的存储过程，和存储过程不同的是不需要主动调用，而是会监听表的动作（插入、删除、更新等）而触发执行。</p><h3 id="mysql触发器"><a href="#mysql触发器" class="headerlink" title="mysql触发器"></a>mysql触发器</h3><p>触发器只有两种触发时机和三种触发事件，分别是：</p><p>触发时机(TIMING)： before 表中数据发生改变前； after 表中数据发声改变后。</p><p>触发事件(EVENT)： insert、delete和update</p><p>组合起来就是六种情况，在一张表上每一种情况只支持一个定义。</p><h3 id="mysql触发器使用"><a href="#mysql触发器使用" class="headerlink" title="mysql触发器使用"></a>mysql触发器使用</h3><p>创建触发器：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">delimiter ##  --定义##为语句结束符，这样可以更自由地写sql语句</span><br><span class="line">create trigger TRIGGER_NAME TIMING EVENT on TABLE_NAME </span><br><span class="line">for each row   -- 固定写法，针对每个行数据都执行如下sql语句</span><br><span class="line">begin</span><br><span class="line">    sql语句;</span><br><span class="line">end</span><br><span class="line">##</span><br><span class="line">delimiter ;  --恢复分号为语句结束符</span><br></pre></td></tr></table></figure></p><p>删除触发器：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop trigger if exists TRIGGER_NAME</span><br></pre></td></tr></table></figure></p><p>变量：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">new: 新增的记录 insert和update两个事件有该值 </span><br><span class="line">old: 之前的记录 delete和update两个事件有该值</span><br></pre></td></tr></table></figure></p><h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><p>两张表：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc user;</span><br><span class="line">+-----------+------------------+------+-----+---------+----------------+</span><br><span class="line">| Field     | Type             | Null | Key | Default | Extra          |</span><br><span class="line">+-----------+------------------+------+-----+---------+----------------+</span><br><span class="line">| id        | int(11) unsigned | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| user_type | int(11) unsigned | NO   |     | 0       |                |</span><br><span class="line">| company   | varchar(100)     | NO   |     |         |                |</span><br><span class="line">| name      | varchar(20)      | NO   |     | NULL    |                |</span><br><span class="line">| age       | int(11) unsigned | NO   |     | 0       |                |</span><br><span class="line">| salary    | int(11) unsigned | NO   |     | 0       |                |</span><br><span class="line">+-----------+------------------+------+-----+---------+----------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; desc user_count;</span><br><span class="line">+--------+------------------+------+-----+---------+-------+</span><br><span class="line">| Field  | Type             | Null | Key | Default | Extra |</span><br><span class="line">+--------+------------------+------+-----+---------+-------+</span><br><span class="line">| counts | int(11) unsigned | NO   |     | NULL    |       |</span><br><span class="line">+--------+------------------+------+-----+---------+-------+</span><br></pre></td></tr></table></figure></p><p>添加两个触发器：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-- 插入触发器</span><br><span class="line">delimiter ##</span><br><span class="line">create trigger user_tri_insert after insert on user </span><br><span class="line">for each row</span><br><span class="line">begin</span><br><span class="line">    update user_count set counts = counts + 1;</span><br><span class="line">end</span><br><span class="line">##</span><br><span class="line">delimiter ;</span><br><span class="line"></span><br><span class="line">-- 删除触发器</span><br><span class="line">delimiter ##</span><br><span class="line">create trigger user_tri_delete after delete on user </span><br><span class="line">for each row</span><br><span class="line">begin</span><br><span class="line">    update user_count set counts = counts - 1;</span><br><span class="line">end</span><br><span class="line">##</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure></p><p>执行表插入和删除的sql：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">insert into user(user_type, company, name, age, salary) values(1, &quot;x&quot;, &quot;f&quot;, 60, 6000);</span><br><span class="line"></span><br><span class="line">---会发现user_count中的值增加了1</span><br><span class="line"></span><br><span class="line">delete from user where name = &apos;f&apos;;</span><br><span class="line"></span><br><span class="line">---会发现user_count中的值减少了1</span><br></pre></td></tr></table></figure></p><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol><li>mysql触发器中的sql语句不能对绑定的表操作，即 绑定到了user表，则触发器中不能对user进行update、insert、delete等操作；</li><li>使用过多会导致维护和排查问题变得困难。</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;mysql触发器创建和使用&lt;/p&gt;
    
    </summary>
    
    
      <category term="database" scheme="http://yoursite.com/tags/database/"/>
    
  </entry>
  
  <entry>
    <title>【转载】hexo 安装使用</title>
    <link href="http://yoursite.com/2019/12/31/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91hexo-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/"/>
    <id>http://yoursite.com/2019/12/31/【转载】hexo-安装使用/</id>
    <published>2019-12-31T01:48:38.000Z</published>
    <updated>2020-01-12T03:06:02.500Z</updated>
    
    <content type="html"><![CDATA[<p>转载hexo安装和使用</p><a id="more"></a><p>详见： <a href="https://cloud.tencent.com/developer/article/1004760" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1004760</a></p><p>记录： </p><ol><li>新建博文： <code>hexo new &quot;new post&quot;</code></li><li>生成静态页面并发布： <code>hexo generate &amp;&amp; hexo deploy</code></li><li>生成的文件位置： <code>/source/_post/</code>和<code>public</code>，因此删除的话，手动删掉这两个文件夹下的内容，然后重新发布即可</li><li>长度控制： <code>&lt;!-- more --&gt;</code></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;转载hexo安装和使用&lt;/p&gt;
    
    </summary>
    
    
      <category term="hexo" scheme="http://yoursite.com/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>https实践</title>
    <link href="http://yoursite.com/2019/10/31/http/https%E5%AE%9E%E8%B7%B5/"/>
    <id>http://yoursite.com/2019/10/31/http/https实践/</id>
    <published>2019-10-30T16:00:00.000Z</published>
    <updated>2019-11-14T13:51:49.235Z</updated>
    
    <content type="html"><![CDATA[<p>本文从如下几个方面对https进行阐述：https的原理、认证方式、具体实践和对https请求的java调用。</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HTTPS将HTTP协议与一组强大的对称、非对称和基于证书的加密技术结合在一起，</span><br><span class="line">使得HTTPS不仅很安全，而且很灵活，很容易在处于无序状态、分散的全发球互联网上进行管理。</span><br></pre></td></tr></table></figure><h2 id="https原理"><a href="#https原理" class="headerlink" title="https原理"></a>https原理</h2><p>增加了SSL（Secure Sockets Layer 安全套接层），在进行TCP传输之前，先通过SSL层对数据进行加密，如下图所示。<br><img src="https://s2.ax1x.com/2019/11/01/KT7jC8.png" alt="https增加ssl层"></p><h2 id="认证方式"><a href="#认证方式" class="headerlink" title="认证方式"></a>认证方式</h2><h2 id="具体实践"><a href="#具体实践" class="headerlink" title="具体实践"></a>具体实践</h2><p>一般部署方式：使用HTTPS/HTTP客户端网关，形式如下：<br><img src="https://s2.ax1x.com/2019/11/01/K7tH9e.png" alt="HTTPS/HTTP客户端网关"></p><p>本地模拟https请求，使用Apache做网关，tomcat做应用服务器，配置工作分为如下几步：</p><ol><li>使用openssl生成认证证书</li><li>Apache配置https和转发</li></ol><p>具体来说，openssl生成认证证书的步骤如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. 下载并安装OpenSSL（[下载地址](http://slproweb.com/products/Win32OpenSSL.html)）</span><br><span class="line">2. 使用如下命令生成证书</span><br><span class="line">    // 生成服务器端私钥文件：</span><br><span class="line">    openssl genrsa -des3 -out server.key 1024</span><br><span class="line">    // </span><br><span class="line">3. 安装server.crt</span><br></pre></td></tr></table></figure></p><p>Apache启用ssl，并作转发的步骤如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1. 配置转发</span><br><span class="line">    如下两行放开注释：</span><br><span class="line">        #LoadModule proxy_module modules/mod_proxy.so</span><br><span class="line">        #LoadModule proxy_http_module modules/mod_proxy_http.so</span><br><span class="line">    转发规则：</span><br><span class="line">        ProxyPass / http://127.0.0.1:8080</span><br><span class="line">        ProxyPassReverse / http://127.0.0.1:8080</span><br><span class="line">2. 配置https</span><br><span class="line">    放开注释：</span><br><span class="line">        #LoadModule ssl_module modules/mod_ssl.so</span><br><span class="line">        #Include conf/extra/httpd-ssl.conf</span><br><span class="line">    修改httpd-ssl.conf文件，需在&lt;VirtualHost _default_:443&gt;标签中修改：</span><br><span class="line">        ServerName zt-httpstest:443</span><br><span class="line">        SSLCertificateFile &quot;$&#123;SRVROOT&#125;/conf/server.crt&quot;</span><br><span class="line">        SSLCertificateKeyFile &quot;$&#123;SRVROOT&#125;/conf/server.key&quot;</span><br></pre></td></tr></table></figure></p><p>效果：<br><img src="https://s2.ax1x.com/2019/11/01/K7s3KU.png" alt="https效果"></p><h2 id="http请求https"><a href="#http请求https" class="headerlink" title="http请求https"></a>http请求https</h2><p>客户端请求https时，可以让客户端信任所有服务器，也可以让客户端信任特定的服务器。 这里以客户端不验证服务器举例（读取特定服务器证书的方法见引用2）。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">import java.io.IOException;</span><br><span class="line">import java.security.SecureRandom;</span><br><span class="line">import java.security.cert.CertificateException;</span><br><span class="line">import java.security.cert.X509Certificate;</span><br><span class="line"></span><br><span class="line">import javax.net.ssl.HostnameVerifier;</span><br><span class="line">import javax.net.ssl.SSLContext;</span><br><span class="line">import javax.net.ssl.SSLSession;</span><br><span class="line">import javax.net.ssl.SSLSocketFactory;</span><br><span class="line">import javax.net.ssl.TrustManager;</span><br><span class="line">import javax.net.ssl.X509TrustManager;</span><br><span class="line"></span><br><span class="line">import okhttp3.MediaType;</span><br><span class="line">import okhttp3.OkHttpClient;</span><br><span class="line">import okhttp3.Request;</span><br><span class="line">import okhttp3.RequestBody;</span><br><span class="line">import okhttp3.Response;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * OKHttp测试</span><br><span class="line"> */</span><br><span class="line">public class OKHttpService &#123;</span><br><span class="line">    </span><br><span class="line">    private OkHttpClient client = new OkHttpClient.Builder()</span><br><span class="line">            .sslSocketFactory(createSSLSocketFactory(), new TrustAllCerts())</span><br><span class="line">            .hostnameVerifier(new TrustAllHostnameVerifier())</span><br><span class="line">            .build();   </span><br><span class="line">    </span><br><span class="line">    private static final MediaType JSON = MediaType.get(&quot;application/json; charset=utf-8&quot;);</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * get请求</span><br><span class="line">     */</span><br><span class="line">    public String get(String url) throws IOException &#123;</span><br><span class="line">        Request request = new Request.Builder()</span><br><span class="line">                .url(url)</span><br><span class="line">                .build();</span><br><span class="line">        Response response = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            response = client.newCall(request).execute();</span><br><span class="line">            return response.body().string();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            if (response != null) &#123;</span><br><span class="line">                response.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * post请求</span><br><span class="line">     */</span><br><span class="line">    public String post(String url, String json) throws IOException &#123;</span><br><span class="line">        if (json == null) &#123;</span><br><span class="line">            json = &quot;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        RequestBody body = RequestBody.create(json.getBytes(), JSON);</span><br><span class="line">        Request request = new Request.Builder()</span><br><span class="line">                .url(url)</span><br><span class="line">                .post(body)</span><br><span class="line">                .build();</span><br><span class="line">        Response response = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            response = client.newCall(request).execute();</span><br><span class="line">            return response.body().string();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            if (response != null) &#123;</span><br><span class="line">                response.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    private static SSLSocketFactory createSSLSocketFactory() &#123;</span><br><span class="line">        SSLSocketFactory ssf = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            SSLContext sc = SSLContext.getInstance(&quot;TLS&quot;);</span><br><span class="line">            sc.init(null, new TrustManager[] &#123; new TrustAllCerts() &#125;, new SecureRandom());</span><br><span class="line">            ssf = sc.getSocketFactory();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return ssf;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 信任所有的服务器证书</span><br><span class="line">     *</span><br><span class="line">     */</span><br><span class="line">    static class TrustAllCerts implements X509TrustManager &#123;</span><br><span class="line">        public void checkClientTrusted(java.security.cert.X509Certificate[] var1, String var2)</span><br><span class="line">                throws CertificateException &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void checkServerTrusted(java.security.cert.X509Certificate[] var1, String var2)</span><br><span class="line">                throws CertificateException &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public X509Certificate[] getAcceptedIssuers() &#123;</span><br><span class="line">            return new X509Certificate[0];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 信任所有主机名</span><br><span class="line">     *</span><br><span class="line">     */</span><br><span class="line">    static class TrustAllHostnameVerifier implements HostnameVerifier &#123;</span><br><span class="line">        public boolean verify(String var1, SSLSession var2) &#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3><ol><li>《HTTP权威指南》</li><li><a href="https://blog.csdn.net/sunny2come/article/details/79912024" target="_blank" rel="noopener">OKHttp对Https的认证的处理</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文从如下几个方面对https进行阐述：https的原理、认证方式、具体实践和对https请求的java调用。&lt;/p&gt;
    
    </summary>
    
    
      <category term="http" scheme="http://yoursite.com/tags/http/"/>
    
  </entry>
  
  <entry>
    <title>23种设计模式--职责链模式</title>
    <link href="http://yoursite.com/2019/04/18/design_pattern/%E8%81%8C%E8%B4%A3%E9%93%BE%E6%A8%A1%E5%BC%8F/"/>
    <id>http://yoursite.com/2019/04/18/design_pattern/职责链模式/</id>
    <published>2019-04-17T16:00:00.000Z</published>
    <updated>2020-02-07T07:12:46.671Z</updated>
    
    <content type="html"><![CDATA[<p>行为型设计模式的一种</p><a id="more"></a><h3 id="【DP】定义"><a href="#【DP】定义" class="headerlink" title="【DP】定义"></a>【DP】定义</h3><p>使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间的耦合关系。将这个对象连成一条链，并沿着这条链传递该请求，知道有一个对象处理它为止。</p><h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><ol><li>一个请求的处理需要多个对象当中的一个或几个协作处理 </li></ol><h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src="https://s2.ax1x.com/2020/02/07/1gnRd1.png" alt="职责链模式"></p><p>类图核心是：抽象处理类中的设置后继者的方法setSuccessor，并且后继者也是抽象处理类类型。这就产生了一种链式结构。</p><h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><p>假设有个请假的单据，自动审批类包括经理审批类、总经理审批类和CEO审批类，每个自动审批类的权限不同，经理审批类只有三天权限，总经理审批类有七天权限，CEO审批类有半个月权限。</p><p>对于这个请假单据的自动审批，就可以用职责链模式，代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 请假单据类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Voucher</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 请假人</span></span><br><span class="line">    <span class="keyword">private</span> String personName;</span><br><span class="line">    <span class="comment">// 请假天数</span></span><br><span class="line">    <span class="keyword">private</span> String leaveDayNum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自动审批抽象类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbsApprove</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 后继者</span></span><br><span class="line">    <span class="keyword">protected</span> AbsApprove successor;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSuccessor</span><span class="params">(AbsApprove successor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.successor = successor;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(Voucher voucher)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 经理自动审批类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ManagerApprove</span> <span class="keyword">extends</span> <span class="title">AbsApprove</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(Voucher voucher)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> leaveDayNum = voucher.getLeaveDayNum();</span><br><span class="line">        <span class="keyword">if</span> (leaveDayNum &lt;= <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="comment">// approve this voucher</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 无权处理，交给下一个职责处理类</span></span><br><span class="line">            <span class="keyword">this</span>.successor.handle(voucher);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 总经理自动审批类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GMApprove</span> <span class="keyword">extends</span> <span class="title">AbsApprove</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(Voucher voucher)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> leaveDayNum = voucher.getLeaveDayNum();</span><br><span class="line">        <span class="keyword">if</span> (leaveDayNum &lt;= <span class="number">7</span>) &#123;</span><br><span class="line">            <span class="comment">// approve this voucher</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 无权处理，交给下一个职责处理类</span></span><br><span class="line">            <span class="keyword">this</span>.successor.handle(voucher);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CEO自动审批类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CEOApprove</span> <span class="keyword">extends</span> <span class="title">AbsApprove</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(Voucher voucher)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> leaveDayNum = voucher.getLeaveDayNum();</span><br><span class="line">        <span class="keyword">if</span> (leaveDayNum &lt;= <span class="number">15</span>) &#123;</span><br><span class="line">            <span class="comment">// approve this voucher</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="comment">// reject this voucher</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户端类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 声明各个审批类，并制定职责链的下一级</span></span><br><span class="line">        AbsApprove manager = <span class="keyword">new</span> ManagerApprove();</span><br><span class="line">        AbsApprove gm = <span class="keyword">new</span> ManagerApprove();</span><br><span class="line">        AbsApprove ceo = <span class="keyword">new</span> CEOApprove();</span><br><span class="line">        manager.setSuccessor(gm); </span><br><span class="line">        gm.setSuccessor(ceo); </span><br><span class="line"></span><br><span class="line">        Voucher voucher = <span class="keyword">new</span> Voucher(<span class="string">"zhangsan"</span>, <span class="number">20</span>);</span><br><span class="line">        <span class="comment">// 初始时交给经理来处理</span></span><br><span class="line">        manager.handle(voucher);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>可以看到，客户端可以指定每个职责类的下一级是谁，然后将任务交给最初的职责类处理，不用管最后是谁处理的。</p><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol><li>重点理解两个词：“职责”和“链”，使用这种模式的时候要看各个类能否区分职责，并且是一个链式结构；</li><li>因为客户端可以随意指定职责类的下一级，因此可以实现越级处理的目的。</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;行为型设计模式的一种&lt;/p&gt;
    
    </summary>
    
    
      <category term="设计模式" scheme="http://yoursite.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>23种设计模式--观察者模式</title>
    <link href="http://yoursite.com/2019/04/17/design_pattern/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
    <id>http://yoursite.com/2019/04/17/design_pattern/观察者模式/</id>
    <published>2019-04-16T16:00:00.000Z</published>
    <updated>2020-02-07T07:14:05.618Z</updated>
    
    <content type="html"><![CDATA[<p>行为型设计模式的一种</p><a id="more"></a><h3 id="【DP】定义"><a href="#【DP】定义" class="headerlink" title="【DP】定义"></a>【DP】定义</h3><p>定义了一种一对多的依赖关系，让多个观察者对象（Observer）同时监听某一个主题对象（Subject）。这个主题对象在状态发生变化时，会通知所有观察者对象，使它们能够自动更新自己。</p><h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><ol><li>当一个抽象模型有两个方面, 其中一个方面依赖于另一方面。将这二者封装在独立的对象中以使它们可以各自独立地改变和复用。</li><li>当一个对象的改变需要同时改变其它对象, 而不知道具体有多少对象有待改变。</li><li>当一个对象必须通知其它对象，而它又不能假定其它对象是谁。换言之, 你不希望这些对象是紧密耦合的。</li></ol><h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src="https://s2.ax1x.com/2020/02/07/1gnaaq.png" alt="观察者模式"></p><p>类图核心是：动作主体的三个方法attach、detach和notify方法，以及动作主体对观察者的使用。观察者类以接口的形式注册到动作主体，使用attach和detach进行观察者的添加和移除，notify方法通过调用各个观察者的update方法，起到通知的作用。</p><p>类图中绿色依赖关系表示可有可无，当观察者需要动作主体的状态等信息时可以依赖具体的动作主体类。</p><h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><p>假设当程序出错时需要分别向本地日志、远程日志和控制台上输出错误信息，并且输出位置以后还可能有变化，那么使用观察者模式就非常合适了。设计如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 动作主体接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">attach</span><span class="params">(Observer observer)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">detach</span><span class="params">(Observer observer)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">notify</span><span class="params">(String msg)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 动作主体类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SubjectImpl</span> <span class="keyword">implements</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Observer&gt; observers;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attach</span><span class="params">(Observer observer)</span> </span>&#123;</span><br><span class="line">        observers.add(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">detach</span><span class="params">(Observer observer)</span> </span>&#123;</span><br><span class="line">        observers.remove(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notify</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Observer observer : observers) &#123;</span><br><span class="line">            observer.writeLog(msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 观察者接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">writeLog</span><span class="params">(String msg)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 观察者实现类1---写本地日志</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LocalLogObserver</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeLog</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// write local log</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 观察者实现类2---写日志服务器上的日志</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RemoteLogObserver</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeLog</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// write remote log</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 观察者实现类3---写控制台</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsoleLogObserver</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeLog</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// print on console</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户端调用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 声明动作主体</span></span><br><span class="line">        Subject subject = <span class="keyword">new</span> SubjectImpl();</span><br><span class="line">        <span class="comment">// 注册观察者</span></span><br><span class="line">        subject.attach(<span class="keyword">new</span> LocalLogObserver());</span><br><span class="line">        subject.attach(<span class="keyword">new</span> RemoteLogObserver());</span><br><span class="line">        subject.attach(<span class="keyword">new</span> ConsoleLogObserver());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 一段可能抛异常的代码</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            String msg = e.getMessage();</span><br><span class="line">            <span class="comment">// 调用通知代码</span></span><br><span class="line">            subject.notify(msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>当有其他的日志打印需求时，可以很方便的注册并在客户端透明的使用。</p><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol><li>当观察者不需要动作主体的状态信息时，观察者完全不依赖动作主体，保证了低耦合。</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;行为型设计模式的一种&lt;/p&gt;
    
    </summary>
    
    
      <category term="设计模式" scheme="http://yoursite.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>23种设计模式--模板方法模式</title>
    <link href="http://yoursite.com/2019/04/15/design_pattern/%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/"/>
    <id>http://yoursite.com/2019/04/15/design_pattern/模板方法模式/</id>
    <published>2019-04-14T16:00:00.000Z</published>
    <updated>2020-02-07T07:09:14.557Z</updated>
    
    <content type="html"><![CDATA[<p>行为型设计模式的一种，该模式是对抽象类的使用。</p><a id="more"></a><h3 id="【DP】定义"><a href="#【DP】定义" class="headerlink" title="【DP】定义"></a>【DP】定义</h3><p>定义一个操作中的算法的骨架，而将一些步骤延迟到子类中。模板方法使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤。</p><h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><p>有很多子类会写很多相同的代码，为了维护方便和减少代码量，可以使用模板方法模式</p><h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src="https://s2.ax1x.com/2020/02/07/1gnrzF.png" alt="模板方法模式"></p><p>类图核心是抽象类，将复用的方法放到抽象类中，并用abstract修饰。</p><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol><li>该模式就是对抽象类的使用，没有必要举例子了。</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;行为型设计模式的一种，该模式是对抽象类的使用。&lt;/p&gt;
    
    </summary>
    
    
      <category term="设计模式" scheme="http://yoursite.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>23种设计模式--状态模式</title>
    <link href="http://yoursite.com/2019/04/13/design_pattern/%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F/"/>
    <id>http://yoursite.com/2019/04/13/design_pattern/状态模式/</id>
    <published>2019-04-12T16:00:00.000Z</published>
    <updated>2020-02-07T07:10:11.989Z</updated>
    
    <content type="html"><![CDATA[<p>行为型设计模式的一种</p><a id="more"></a><h3 id="【DP】定义"><a href="#【DP】定义" class="headerlink" title="【DP】定义"></a>【DP】定义</h3><p>当一个对象的内在状态改变时，允许改变其行为，这个对象看起来像是改变了其类。</p><h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><p>一个对象在多个状态下行为不同，且这些状态可以互相转换</p><h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src="https://s2.ax1x.com/2020/02/07/1gnhi6.png" alt="状态模式"></p><p>该类图的核心是： 状态管理类和状态接口的聚合关系，以及状态类方法的参数是状态管理类。</p><h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><p>假设单据审批过程的状态包括： 未提交、未审核、已完成三个状态，处于每个状态的单据都需要有不同的处理，具体如下：</p><ol><li>未提交状态的处理是提交，并切换到未审核状态；</li><li>未审核状态的处理是审核，并切换到已完成状态；</li><li>已完成状态的处理是打印单据。</li></ol><p>按照状态模式首先定义状态接口和实现类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 状态管理类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Context</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> State state;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Context</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 初始状态为未提交</span></span><br><span class="line">        <span class="keyword">this</span>.state = <span class="keyword">new</span> UnCommit();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(State state)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 外部请求</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        state.handle(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 状态接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">handle</span><span class="params">(Context context)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 未提交</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnCommit</span> <span class="keyword">implements</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 做提交</span></span><br><span class="line">        doSomethingToCommit();</span><br><span class="line">        <span class="comment">// 修改状态</span></span><br><span class="line">        context.setState(<span class="keyword">new</span> UnApprove());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 未审核</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnApprove</span> <span class="keyword">implements</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 做审核</span></span><br><span class="line">        doSomethingToApprove();</span><br><span class="line">        <span class="comment">// 修改状态</span></span><br><span class="line">        context.setState(<span class="keyword">new</span> Complete());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 已完成</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Complete</span> <span class="keyword">implements</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 打印单据</span></span><br><span class="line">        doSomethingToPrint();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>客户端处理如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建状态管理类，并初始为未提交状态</span></span><br><span class="line">        Context context = <span class="keyword">new</span> Context();</span><br><span class="line">        <span class="comment">// 第一次请求，执行提交，状态变为未审核状态</span></span><br><span class="line">        context.request();</span><br><span class="line">        <span class="comment">// 第二次请求，执行审核，状态变为已完成状态</span></span><br><span class="line">        context.request();</span><br><span class="line">        <span class="comment">// 第三次请求，执行打印</span></span><br><span class="line">        context.request();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>可以看到，客户端在调用时不需要担心当前状态是什么，只需要依次执行请求即可，每个状态有自己的处理和状态切换。</p><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol><li>与策略模式的对比：二者虽然都是行为模式，且类图很像，都是让客户端透明的执行算法策略或者状态操作，但是策略模式是封装了算法的变化，各个算法类之间没有关系，而状态模式是封装了状态的变化，各个状态之间可以转换。</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;行为型设计模式的一种&lt;/p&gt;
    
    </summary>
    
    
      <category term="设计模式" scheme="http://yoursite.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>23种设计模式--策略模式</title>
    <link href="http://yoursite.com/2019/04/10/design_pattern/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/"/>
    <id>http://yoursite.com/2019/04/10/design_pattern/策略模式/</id>
    <published>2019-04-09T16:00:00.000Z</published>
    <updated>2020-02-07T07:10:46.047Z</updated>
    
    <content type="html"><![CDATA[<p>行为型设计模式的一种</p><a id="more"></a><h3 id="【DP】定义"><a href="#【DP】定义" class="headerlink" title="【DP】定义"></a>【DP】定义</h3><p>定义了算法家族，分别封装起来，让它们之间可以互相替换，此模式让算法的变化不会影响到使用算法的客户。</p><h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><ol><li>从定义中可以看出，如果有很多种算法或者执行策略，在客户端的判断会破坏开闭原则，因此在这种情况下可以使用策略模式</li></ol><h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src="https://s2.ax1x.com/2020/02/07/1gnDRU.png" alt="策略模式"></p><p>类图的核心是： 使用接口封装行为（或者说是封装变化），在上下文类中调用策略的接口。</p><p>其实是对java多态的使用。</p><h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><p>图表是有维度的概念的，但是不同类型维度的处理是不一样的，比如有字段维度和时间分组维度。在拼sql时，字段维度是直接放在group by后的内容，时间分组维度要先进行时间的截取，放到group by后边的应该是对字段的截取后的内容。</p><p>比如：</p><p>要按照组织分组，那么这个是字段维度，sql中是<figure class="highlight plain"><figcaption><span>by pk_org```;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">要按照年分组，那么这个是分组维度，sql中是```group by substr(time, 1, 4) ```, ```substr```是对time字段（对应的值是19位的时间2019-04-10 17:15:20）截前四位。</span><br><span class="line"></span><br><span class="line">那么两种不同维度的处理不同，就可以使用策略模式，代码如下：</span><br><span class="line">```Java</span><br><span class="line">/**</span><br><span class="line"> * 策略接口</span><br><span class="line"> */</span><br><span class="line">public interface Strategy &#123;</span><br><span class="line">    String getGroupByStr(String fieldName);</span><br><span class="line">&#125;</span><br><span class="line">public class FieldStrategy implements Strategy &#123;    </span><br><span class="line">    @Override</span><br><span class="line">    public String getGroupByStr(String fieldName) &#123;</span><br><span class="line">        return fieldName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class TimeGroupStrategy implements Strategy &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public String getGroupByStr(String fieldName) &#123;</span><br><span class="line">        return &quot;substr(&quot; + fieldName + &quot;, 1, 4)&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 使用策略的上下文类</span><br><span class="line"> */</span><br><span class="line">public class StrategyContext &#123;</span><br><span class="line">    private Strategy strategy;</span><br><span class="line">    public StrategyContext(Strategy strategy) &#123;</span><br><span class="line">        this.strategy = strategy;</span><br><span class="line">    &#125;</span><br><span class="line">    public String getGroupByStr(String fieldName) &#123;</span><br><span class="line">        return strategy.getGroupByStr(fieldName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 客户端</span><br><span class="line"> */</span><br><span class="line">public class Main &#123;</span><br><span class="line">    public static void main() &#123;</span><br><span class="line">        Strategy strategy = new TimeGroupStrategy();</span><br><span class="line">        StrategyContext ctx = new StrategyContext(strategy);</span><br><span class="line">        ctx.getGroupByStr(&quot;abcd&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>看完例子之后一定有两个疑问：</p><ol><li>为什么客户端代码还是有需要区分策略类型的代码？</li><li>上下文类的作用是什么，直接调用接口不就可以了吗？</li></ol><p>对第一个问题，客户端的判断逻辑代码是可以挪到简单工厂类，这里我们可以把他挪到上下文类中；</p><p>对第二个问题，上下文类在这个例子中只是调了一下策略接口的方法，然而在实际应用中，接口调用的前后可能需要一些处理，这些就可以在上下文类中实现，同时有选择性地向上层调用暴露方法，使代码更加灵活。</p><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol><li>在理解策略模式的时候应该首先明确它是行为型模式，策略类是对变化的封装;</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;行为型设计模式的一种&lt;/p&gt;
    
    </summary>
    
    
      <category term="设计模式" scheme="http://yoursite.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>23种设计模式--原型模式</title>
    <link href="http://yoursite.com/2019/04/09/design_pattern/%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/"/>
    <id>http://yoursite.com/2019/04/09/design_pattern/原型模式/</id>
    <published>2019-04-08T16:00:00.000Z</published>
    <updated>2020-02-07T06:59:20.581Z</updated>
    
    <content type="html"><![CDATA[<p>创建型设计模式的一种</p><a id="more"></a><h3 id="【DP】定义"><a href="#【DP】定义" class="headerlink" title="【DP】定义"></a>【DP】定义</h3><p>用原型实例指定创建对象的种类，并且通过拷贝这些原型创建新的对象。</p><h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><p>用于拷贝对象</p><h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src="https://s2.ax1x.com/2020/02/07/1gn2ZR.png" alt="原型模式"></p><p>核心就是实现Cloneable接口</p><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol><li>原型模式主要是Cloneable接口的使用，实现简单，多和其他模式共同使用；</li><li>需要注意深克隆和浅克隆的事情，这里不做过多介绍，可以查看<a href="http://note.youdao.com/noteshare?id=5d3dc9c6e07bde4cb676573810effcec&amp;sub=B34DA3B86D594A189691A32B7FF86219" target="_blank" rel="noopener">小知识点</a>中的第六条；</li><li>克隆不会执行构造方法；</li><li>克隆并不会判断方法和对象的访问权限，因此对于单例类，虽然属性和构造方法都是private的，但是仍然会克隆一份，故原型模式和单例模式不能同时使用。</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;创建型设计模式的一种&lt;/p&gt;
    
    </summary>
    
    
      <category term="设计模式" scheme="http://yoursite.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>23种设计模式--建造者模式</title>
    <link href="http://yoursite.com/2019/04/08/design_pattern/%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
    <id>http://yoursite.com/2019/04/08/design_pattern/建造者模式/</id>
    <published>2019-04-07T16:00:00.000Z</published>
    <updated>2020-02-07T07:03:58.636Z</updated>
    
    <content type="html"><![CDATA[<p>创建型设计模式的一种</p><a id="more"></a><h3 id="【DP】定义"><a href="#【DP】定义" class="headerlink" title="【DP】定义"></a>【DP】定义</h3><p>将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示</p><h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><p>需要构建一批构建过程相同但表示不同的产品，而构建过程非常复杂，为了防止构建过程遗漏步骤，需要建造者模式</p><h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src="https://s2.ax1x.com/2020/02/07/1gndI0.png" alt="建造者模式"></p><h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><p>假设有一套单据，结构相同，但是很复杂，每个单据的显示内容各不相同。类结构如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 单据类，省略getter、setter方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Invoice</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> LeftHeader leftHeader;</span><br><span class="line">    <span class="keyword">private</span> RightHeader rightHeader;</span><br><span class="line">    <span class="keyword">private</span> LeftBody leftBody;</span><br><span class="line">    <span class="keyword">private</span> RightBody rightBody;</span><br><span class="line">    <span class="keyword">private</span> LeftTail leftTail;</span><br><span class="line">    <span class="keyword">private</span> RightTail rightTail;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>那么为了构建这样一个类，需要调用各个部分的构造方法，因为重复代码太多，很容易在写的过程中遗漏某个部分，因此可以使用建造者模式构建一个Builder接口，将所有的方法封装起来。代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line">    <span class="function">LeftHeader <span class="title">buildLeftHeader</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">RightHeader <span class="title">buildRightHeader</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// 省略其他方法......</span></span><br><span class="line">    <span class="function">Invoice <span class="title">buildInvoice</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>在创建不同的单据时，可以创建具体的建造者类，比如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 账单单据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BillBuilder</span> <span class="keyword">implements</span> <span class="title">Builder</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Invoice billInvoice;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BillBuilder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        billInvoice = <span class="keyword">new</span> Invoice();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LeftHeader <span class="title">buildLeftHeader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        LeftHeader leftHeader = <span class="keyword">new</span> LeftHeader();</span><br><span class="line">        <span class="comment">// do something with leftHeader</span></span><br><span class="line">        billInvoice.setLeftHeader(leftHeader);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RightHeader <span class="title">buildRightHeader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RightHeader rightHeader = <span class="keyword">new</span> RightHeader();</span><br><span class="line">        <span class="comment">// do something with rightHeader</span></span><br><span class="line">        billInvoice.setRightHeader(rightHeader);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Invoice <span class="title">buildInvoice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> billInvoice;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>有了接口的约束，就不会少构建Invoice的某个部分了。但是在客户端调用时，仍然会有可能少调用实现的方法，那么就需要建造者模式的核心类Director（指挥者）了，代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Director</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Invoice <span class="title">buildInvoice</span><span class="params">(Builder builder)</span> </span>&#123;</span><br><span class="line">        builder.buildLeftHeader();</span><br><span class="line">        builder.buildRightHeader();</span><br><span class="line">        <span class="comment">// 省略其他方法......</span></span><br><span class="line">        <span class="keyword">return</span> builder.buildInvoice();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>客户端调用Director就可以透明的创建一个对象，而不用担心会少调用某个方法了，客户端代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Builder billBuilder = <span class="keyword">new</span> BillBuilder();</span><br><span class="line">        Director director = <span class="keyword">new</span> Director();</span><br><span class="line">        Invoice billInvoice = director.buildInvoice(billBuilder);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol><li>建造者模式主要用于一些复杂对象但是结构相似的对象的构建，上文中的例子只写了billInvoice，当然也可以有stockInvoice等等</li><li>建造者模式在只有一个具体的构建对象（比如只有一个billInvoice）时，可以将建造者的具体实现类和Director指挥者类合并在一起，将Director中的build方法放到建造者具体实现类的build方法中</li><li>和<strong>抽象工厂模式</strong>类似，都能够约束创建对象的过程，让客户端能够透明的创建对象，但是二者的<strong>目的和实现方式</strong>不同：抽象工厂模式是为了抽象实现接口而定义了抽象工厂类，建造者模式是为了复用复杂对象的构建过程，保证客户端不会遗漏对象的某个部分，从而创建了指挥者类。</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;创建型设计模式的一种&lt;/p&gt;
    
    </summary>
    
    
      <category term="设计模式" scheme="http://yoursite.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>23种设计模式--单例模式</title>
    <link href="http://yoursite.com/2019/04/07/design_pattern/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
    <id>http://yoursite.com/2019/04/07/design_pattern/单例模式/</id>
    <published>2019-04-06T16:00:00.000Z</published>
    <updated>2019-09-27T03:29:46.756Z</updated>
    
    <content type="html"><![CDATA[<p>创建型设计模式的一种</p><a id="more"></a><h3 id="【DP】定义"><a href="#【DP】定义" class="headerlink" title="【DP】定义"></a>【DP】定义</h3><p>保证一个类仅有一个实例，并提供一个访问他的全局访问点。</p><h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><ol><li>需要全局唯一，并维护某个全局变量</li><li>避免对象重复创建，减少内存空间占用</li></ol><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><h4 id="懒汉模式—非线程安全"><a href="#懒汉模式—非线程安全" class="headerlink" title="懒汉模式—非线程安全"></a>懒汉模式—非线程安全</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Singleton instance;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>核心是：instance和构造方法要私有，getInstance方法要是静态的。</p><h4 id="懒汉模式-使用Double-Check-Locking-—线程安全"><a href="#懒汉模式-使用Double-Check-Locking-—线程安全" class="headerlink" title="懒汉模式(使用Double-Check Locking)—线程安全"></a>懒汉模式(使用Double-Check Locking)—线程安全</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Singleton instance;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(Singleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>核心是： 两次判空和synchronized的同步。</p><p>两次判空的目的是：当instance存在时，就直接返回。当instance为null时，如果有两个线程同时调用getInstance()方法，他们都会通过第一个if判断，然后会进入加锁的临界区，第一个线程进入后，执行完instance已经有值了，然后第二个线程进入临界区，如果没有第二个if语句，会导致instance会被重新实例化，导致instance不是单例了。</p><h4 id="懒汉模式-静态内部类-—线程安全"><a href="#懒汉模式-静态内部类-—线程安全" class="headerlink" title="懒汉模式(静态内部类)—线程安全"></a>懒汉模式(静态内部类)—线程安全</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyLoader</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton INSTANCE = <span class="keyword">new</span> Singleton();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> LazyLoader.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>核心是： LazyLoader必须是private和static修饰，保证只有Singleton调用。</p><p>这种方式是懒加载模式，只有调用<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 饿汉模式---线程安全</span><br><span class="line">```Java</span><br><span class="line">public class Singleton &#123;</span><br><span class="line">    private static final Singleton instance = new Singleton();</span><br><span class="line">    private Singleton() &#123;&#125;</span><br><span class="line">    public static Singleton getInstance() &#123;</span><br><span class="line">        return instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>在类初始化的时候就会初始化instance对象，由于又是final类型的，所以instance不会改变，保证内存中只有一个对象存在。</p><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol><li>尽量使用线程安全的方式实现</li><li>Double-check Locking在使用中依然有问题，原因是在new Singleton()时jvm对字节码的重排序操作。修改方法是给instance增加volatile修饰符，volatile会增加内存屏障，防止重排序。具体可以看<a href="https://www.cnblogs.com/a154627/p/10046147.html" target="_blank" rel="noopener">传统单例模式双重检查锁存在的问题</a>.</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;创建型设计模式的一种&lt;/p&gt;
    
    </summary>
    
    
      <category term="设计模式" scheme="http://yoursite.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>23种设计模式--工厂模式</title>
    <link href="http://yoursite.com/2019/04/06/design_pattern/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/"/>
    <id>http://yoursite.com/2019/04/06/design_pattern/工厂模式/</id>
    <published>2019-04-05T16:00:00.000Z</published>
    <updated>2020-02-07T07:03:24.802Z</updated>
    
    <content type="html"><![CDATA[<p>创建型设计模式的一种</p><a id="more"></a><h3 id="简单工厂模式"><a href="#简单工厂模式" class="headerlink" title="简单工厂模式"></a>简单工厂模式</h3><p>在说工厂模式之前，先说一下简单工厂模式。</p><p>简单工厂模式是为了避免在客户端调用时判断各种复杂逻辑，所有的都放到单独的简单工厂类中处理。</p><h4 id="简单工厂模式举例"><a href="#简单工厂模式举例" class="headerlink" title="简单工厂模式举例"></a>简单工厂模式举例</h4><p>假设数据模型分两种，二维模型(TwoDimModel)和多维模型(MultiDimModel)，各自的处理方式不同，于是客户端需要有如下调用方式：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 处理模型的服务接口</span></span><br><span class="line">    IService srv = <span class="keyword">null</span>;</span><br><span class="line">    Model model = <span class="keyword">new</span> TwoDimModel();</span><br><span class="line">    <span class="comment">// Model model = new MultiDimModel();</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"two-dim"</span>.equals(model.getModelType())) &#123;</span><br><span class="line">      srv = <span class="keyword">new</span> TwoDimService();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"multi-dim"</span>.equals(model.getModelType())) &#123;</span><br><span class="line">      srv = <span class="keyword">new</span> MultiDimService();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 执行操作</span></span><br><span class="line">    srv.operate();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>可以看到，这样就把获取服务的代码和调用方法的代码混在一起了，而且如果很多地方都需要调用IService服务，就会造成很多代码重复，同时会导致维护和修改困难。那么就可以使用简单工厂模式，将获取服务的代码放在工厂类中，如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 工厂类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IService <span class="title">createService</span><span class="params">(String modelType)</span> </span>&#123;</span><br><span class="line">    IService srv = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"two-dim"</span>.equals(modelType)) &#123;</span><br><span class="line">      srv = <span class="keyword">new</span> TwoDimService();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"multi-dim"</span>.equals(modelType)) &#123;</span><br><span class="line">      srv = <span class="keyword">new</span> MultiDimService();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> srv;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户端类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Model model = <span class="keyword">new</span> TwoDimModel();</span><br><span class="line">    <span class="comment">// Model model = new MultiDimModel();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理模型的服务接口</span></span><br><span class="line">    IService srv = ServiceFactory.createService(model.getModelType());</span><br><span class="line">    <span class="comment">// 执行操作</span></span><br><span class="line">    srv.operate();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>这样在获取服务的地方只需要使用ServiceFactory的create方法即可，客户端不需要关注具体是哪个service。</p><h4 id="简单工厂模式类图"><a href="#简单工厂模式类图" class="headerlink" title="简单工厂模式类图"></a>简单工厂模式类图</h4><p><img src="https://s2.ax1x.com/2020/02/07/1gnxW8.png" alt="简单工厂模式类图"></p><p>该模式的精髓是工厂类的create方法，一般是静态方法。</p><h4 id="简单工厂模式的局限"><a href="#简单工厂模式的局限" class="headerlink" title="简单工厂模式的局限"></a>简单工厂模式的局限</h4><p>当我们增加模型的种类，比如加一个三维模型（非多维模型），那么需要做两件事：1. 增加模型类；2. 在工厂方法中增加if判断。 但是在工厂方法中修改就不满足“开闭原则”了，因为是对修改的是关闭的。所以需要引入下面的工厂模式。</p><h3 id="工厂模式实现上述举例"><a href="#工厂模式实现上述举例" class="headerlink" title="工厂模式实现上述举例"></a>工厂模式实现上述举例</h3><p>工厂模式实现上述举例，只需要将工厂类抽象成接口，然后对每一个服务分别创建工厂方法，代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 工厂接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IFactory</span> </span>&#123;</span><br><span class="line">  <span class="function">IService <span class="title">createService</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 二维模型服务工厂</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TwoDimSrvFactory</span> <span class="keyword">implements</span> <span class="title">IFactory</span></span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> IService <span class="title">createService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> TwoDimService();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 多维模型服务工厂</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MultiDimSrvFactory</span> <span class="keyword">implements</span> <span class="title">IFactory</span></span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> IService <span class="title">createService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MultiDimService();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户端类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Model model = <span class="keyword">new</span> TwoDimModel();</span><br><span class="line">    <span class="comment">// Model model = new MultiDimModel();</span></span><br><span class="line">    <span class="comment">// 服务工厂</span></span><br><span class="line">    IFactory factory = <span class="keyword">new</span> TwoDimSrvFactory();</span><br><span class="line">    <span class="comment">// 处理模型的服务接口</span></span><br><span class="line">    IService srv = factory.createService();</span><br><span class="line">    <span class="comment">// 执行操作</span></span><br><span class="line">    srv.operate();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>这样在增加一种模型的时候，同样需要做两件事： 1. 创建模型类；2. 创建模型服务的工厂类。这样就避免了在简单工厂方法中对工厂类的侵入和修改。</p><p>但是很明显，这又把对模型的判断放到了客户端调用位置，因此在增加模型的时候会对客户端类进行大量的修改。这就需要<a href="https://tengyuanjack.github.io/2019/04/06/design_pattern/%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F+[%E6%8A%BD%E8%B1%A1]%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/" target="_blank" rel="noopener">简单工厂模式+抽象工厂模式</a>来更好的解决。</p><h3 id="工厂模式类图"><a href="#工厂模式类图" class="headerlink" title="工厂模式类图"></a>工厂模式类图</h3><p><img src="https://s2.ax1x.com/2020/02/07/1gupQg.png" alt="工厂模式类图"></p><p>该类图的核心是创建工厂接口，不同的服务使用对应的工厂方法创建。</p><h3 id="工厂模式【DP】定义"><a href="#工厂模式【DP】定义" class="headerlink" title="工厂模式【DP】定义"></a>工厂模式【DP】定义</h3><p>定义一个用于创建对象的接口(上述的IFactory解耦)，让子类决定实例化哪一个类。工厂方法使一个类的实例化延迟到其子类。</p><h3 id="工厂模式使用场景"><a href="#工厂模式使用场景" class="headerlink" title="工厂模式使用场景"></a>工厂模式使用场景</h3><ol><li>希望工厂与产品的种类对客户端保持透明，给客户端提供一致的操作</li><li>不同的工厂和产品可以提供客户端不同的服务或功能</li></ol><h3 id="工厂模式注意事项"><a href="#工厂模式注意事项" class="headerlink" title="工厂模式注意事项"></a>工厂模式注意事项</h3><ol><li>简单工厂模式和工厂模式都是从一堆产品（服务、模型等）中选择一个使用，工厂模式中的不同的具体工厂类还能提供一些其他功能，从代码隔离角度来说，如果除了获取某一个产品，还需要一些复杂的逻辑实现，那么使用工厂方法更好一些，反之，如果只需要获取某个产品，那使用简单工厂即可。</li><li>再次强调： 使用工厂模式，在客户端调用仍然会使用一些判断，将服务类型判断和客户端调用混在一起，做不到无侵入地增加产品，比较好的方法见<a href="https://tengyuanjack.github.io/2019/04/06/design_pattern/%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F+[%E6%8A%BD%E8%B1%A1]%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/" target="_blank" rel="noopener">简单工厂模式+抽象工厂模式</a>.</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;创建型设计模式的一种&lt;/p&gt;
    
    </summary>
    
    
      <category term="设计模式" scheme="http://yoursite.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>23种设计模式--简单工厂模式+【抽象】工厂模式</title>
    <link href="http://yoursite.com/2019/04/06/design_pattern/%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F+%5B%E6%8A%BD%E8%B1%A1%5D%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/"/>
    <id>http://yoursite.com/2019/04/06/design_pattern/简单工厂模式+[抽象]工厂模式/</id>
    <published>2019-04-05T16:00:00.000Z</published>
    <updated>2020-02-07T07:11:51.464Z</updated>
    
    <content type="html"><![CDATA[<p>工厂模式的组合，避免客户端对不同类型的逻辑判断</p><a id="more"></a><p>建议先看<a href="https://tengyuanjack.github.io/2019/04/06/design_pattern/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/" target="_blank" rel="noopener">工厂模式</a>和<a href="https://tengyuanjack.github.io/2019/04/06/design_pattern/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/" target="_blank" rel="noopener">抽象工厂模式</a></p><h3 id="核心改动"><a href="#核心改动" class="headerlink" title="核心改动"></a>核心改动</h3><p>将客户端的判断逻辑放到工厂类中。</p><h3 id="需要这种组合的原因"><a href="#需要这种组合的原因" class="headerlink" title="需要这种组合的原因"></a>需要这种组合的原因</h3><p>在<a href="https://tengyuanjack.github.io/2019/04/06/design_pattern/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/" target="_blank" rel="noopener">工厂模式</a>和<a href="https://tengyuanjack.github.io/2019/04/06/design_pattern/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/" target="_blank" rel="noopener">抽象工厂模式</a>中已经强调过了，在新增数据模型类型时，客户端仍然需要对模型类型进行判断。而我们知道，简单工厂模式能够把客户端的逻辑判断放到工厂类中，所以使用组合方式能够使变动对客户端透明。</p><h3 id="如何在工厂类中避免复杂的if判断或switch判断"><a href="#如何在工厂类中避免复杂的if判断或switch判断" class="headerlink" title="如何在工厂类中避免复杂的if判断或switch判断"></a>如何在工厂类中避免复杂的if判断或switch判断</h3><p>既然要使用简单工厂方法把客户端的判断放到工厂类中，那么必然会产生大量的if和switch判断，可以使用“注册+反射”的方式避免。</p><p>“注册”只在配置文件中注册类名，“反射”是利用jdk的反射机制构建注册的类。</p><p>使用配置文件就不存在增加类后会侵入工厂类代码的情况了。</p><p>这种方式简化了代码的处理，但是会增加工程部署的复杂性，因此使用者需要trade off。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;工厂模式的组合，避免客户端对不同类型的逻辑判断&lt;/p&gt;
    
    </summary>
    
    
      <category term="设计模式" scheme="http://yoursite.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
</feed>
